<html>
<head>
<link href="../shared/style.css" rel="stylesheet" type="text/css" />
</head>

<body>

<h1>Using the Circuit virtual machine</h1>

<h2>Introduction</h2>

The Circuit virtual machine (CVM) can execute circuits produced by the
Faerieplay compiler. It takes a circuit and inputs for that circuit, executes
the circuit on the inputs, and prints the result.

<h2>The architecture</h2>

<p>
The CVM is intended to be run in the standard configuration for a system
utlizing a hardware TTP: a small component (ie. which needs little RAM) in the
secure hardware, and a larger component on the standard host machine, which handles all larger storage. The secure
hardware we support is the IBM 4758 secure coprocessor (SCop). The SCop component
is called <code>cvm</code>, and the host program is called
<code>card_server</code>.
<p>
The SCop piece can also be compiled to run on the host, communicating to the
storage server over UDP. See the <a href="INSTALL.html">INSTALL</a> file for
details on how to do this.

<h2>Running</h2>

<ul>
<li>First obtain a circuit file from the compiler, eg.
<code>prog.runtime</code>.

<li>Generate inputs for the program in the C-Json format. Example C-Json files
  can be found in the <code>sfdl</code> module, eg. <code>gcd-input.cjs</code>
  and <code>insert-sort-input.cjs</code>.
   <p>
  Note that the C-Json format has some support for concatenating data files. Eg.
  The inputs for gcd could be the monolithic <code>{a=35,b=28}</code>, or the
  concatenation of <code>{a=25}</code> and <code>{b=35}</code>.

<li>Start the storage server on the host, eg<br/>
<pre>  $ card_server -d /tmp/faerieplay</pre>
  to use the directory '/tmp/faerieplay' for writing the data. NOTE: this working directory is just an example, but it should be on a local, not a network drive. Otherwise the circuit VM will be very slow.
 <p>
  The running server can be used for many runs of the CVM.
<p>It responds to two
  signals:
  <ul><li>SIGINT: delete all the data (arrays/containers) it has written</li>
<li>SIGQUIT: exit</li>
  </ul>

<li> Run the circuit over the inputs:</br>
<pre>  $ cvm prog.runtime < inputs.cjs</pre>
  This will print the results on standard output.
</li>
</ul>



</body>
</htm>
